@using AliasManger.Internal.AliasDetails



    <SfGrid DataSource="@AliasList" AllowResizing="false" AllowSorting="true" AllowPaging="true" AllowTextWrap="true" AllowExcelExport="true">        
        <GridTextWrapSettings WrapMode="WrapMode.Content"></GridTextWrapSettings>
        <GridPageSettings PageSize="20"></GridPageSettings>
        <GridColumns>
            <GridColumn Field=@nameof(AmAlias.aliasID) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_Id")" Width="60">
                <Template>
                    @{
                        var rep = (context as AmAlias);
                        <div>                            
                             <div class="alink" @onclick="@(() => ShowAliasInfo(rep.aliasID))"><span class="oi oi-zoom-in"></span> @rep.aliasID</div>
                        </div>
                    }
                </Template>
            </GridColumn>
            <GridColumn Field=@nameof(AmAlias.LicName) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_LicName")" Width="140">
                <Template>
                    @{
                        var rep = (context as AmAlias);
                        if (String.IsNullOrEmpty(rep.LicName))
                        {
                            <div>@AmLocalizer.GetText("AliasFilter_License_Uebergreifend")</div>
                        }
                        else
                        {
                            <div>@rep.LicName</div>
                        }
                    }
                </Template>
        </GridColumn>
        <GridColumn Field=@nameof(AmAlias.hcmProfilName) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_HCMProfile")" Width="140"></GridColumn>
        
        <GridColumn Field=@nameof(AmAlias.aliasName) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_Name")" Width="170"></GridColumn>
        <GridColumn Field=@nameof(AmAlias.aliasAddress) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_Street")" Width="160"></GridColumn>
        <GridColumn Field=@nameof(AmAlias.aliasStatusID) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_Status")" Width="90">
            <Template>
                @{
                    var rep = (context as AmAlias);
                    <div>@AmLocalizer.GetText(AmEnums.AliasStatusDic[rep.aliasStatusID])</div>
                }
            </Template>
            </GridColumn>
        <GridColumn Field=@nameof(AmAlias.AuthDate) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_CreatedOn")" Type="ColumnType.DateTime"  Width="110"></GridColumn>
        <GridColumn Field=@nameof(AmAlias.AuthFullName) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_CreatedBy")"  Width="120"></GridColumn>
        <GridColumn Field=@nameof(AmAlias.WaitingForAuth) HeaderText="@AmLocalizer.GetText("AliasList_Content_Column_Wait4Auth")" DisplayAsCheckBox="true"  Width="120"></GridColumn>
        </GridColumns>
    </SfGrid>




@if (_showAliasInfoPopUp)
{
    <CascadingValue Value="@CurrentUserLogin" Name="CurrentUserLogin">
    <CascadingValue Value="@AllowActions" Name="AllowActions">
    <CascadingValue Value="@AllowAuthorization" Name="AllowAuthorization">
    <CascadingValue Value="@VgsAccountId" Name="VgsAccountId">
        <AliasInfoPopUp @bind-ShowModal="_showAliasInfoPopUp" AliasId="_currentAliasId"
            OnDialogClosed=@(async() => await OnAliasInfoDialogClosed.InvokeAsync()) >
        </AliasInfoPopUp> 
    </CascadingValue>
    </CascadingValue>
    </CascadingValue>
    </CascadingValue>
}

@code {

    [Inject] private IAliasManagerLocalizer AmLocalizer { get; set; }
    [Inject] private ILogger<AmAliasGrid> _logger { get; set; }

    
    [Parameter] public string CurrentUserLogin { get; set; }
    [Parameter] public string VgsAccountId { get; set; }
    [Parameter] public bool AllowActions { get; set; }
    [Parameter] public bool AllowAuthorization { get; set; }
    [Parameter] public List<AmAlias> AliasList { get; set; }
    [Parameter] public EventCallback OnAliasInfoDialogClosed { get; set; }


    protected int _loadingStatus { get; set; }


    private AmAliasFilter _inputFilter { get; set; }
    private int _currentAliasId { get; set; }
    private bool _showAliasInfoPopUp { get; set; }


    private void ShowAliasInfo(int aliasId)
    {
        _currentAliasId = aliasId;
        _showAliasInfoPopUp = true;
    }
}

